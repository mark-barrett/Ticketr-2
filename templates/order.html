{% extends "base.html" %}

{% block title %}Ticketr - Manage Tickets{% endblock %}

{% block content %}

{% include 'menu.html' %}
{% if messages %}
{% for message in messages %}
<div class="alert alert-{{ message.tags }} text-center" style="margin-bottom: 0px" role="alert">
    {{ message }}
</div>
{% endfor %}
{% endif %}
<div class="small_background">
    <div class="container text-white">

        <h2>
            Order
        </h2>
    </div>
</div>
<div class="container small_background_container">
    <div style="margin-top: 100px">
        <div class="row">
            <div class="col-md-7 py-2">
                <div class="h-100">
                    <h1>{{ ticket.event.title }}</h1>
                    <p>{{ ticket.event.start_date }} @ {{ ticket.event.start_time }} - {{ ticket.event.end_date }} @ {{ ticket.event.end_time }}<br/>
                        {{ ticket.event.location }}</p>

                    <div style="bottom: 0">
                        <div class="alert alert-warning"><h6>Your held tickets will be released to the public in <span id="time">10:00</span> <small>minutes</small></h6></div>
                    </div>
                </div>
            </div>
            <div class="col-md-5 py-2">
                <div class="h-100">
                    <img src="/{{ticket.event.image}}" width="100%" style="border-radius: 5px; margin-top: -50px; bottom: 0"/>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">Your Order</div>
                <div class="card-body">

                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">Organiser</div>
                <div class="card-body">
                    <div class="float-right">
                        <h3>{{ticket.event.organiser.name}}</h3>
                        <hr/>
                        <a href="#" class="btn btn-dark">Profile</a> <a href="#" class="btn btn-dark">Contact</a>
                    </div>
                    <img src="/{{ticket.event.organiser.image}}" height="120px" style="border-radius: 5px;"/>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function startTimer(duration, display) {
        var timer = duration, minutes, seconds;
        setInterval(function () {
            minutes = parseInt(timer / 60, 10)
            seconds = parseInt(timer % 60, 10);
            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;
            display.textContent = minutes + ":" + seconds;
            if (--timer < 0) {
                window.location="/ticket-timeout/{{ token }}";
            }
        }, 1000);
    }
    window.onload = function () {
        var fiveMinutes = 60 * 10,
            display = document.querySelector('#time');
        startTimer(fiveMinutes, display);
    };
    window.addEventListener("beforeunload", function (e) {
        $.ajax({
            url: '/ticket-timeout/{{ token }}',
            type: 'GET',
            async: false,
            timeout: 4000
        });
    });
</script>


{% endblock content %}